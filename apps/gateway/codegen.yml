overwrite: true

schema:
  - "${CORE_SERVICE_URL:http://localhost:50051/graphql}"

generates:
  ./src/generated/types.ts:
    plugins:
      - typescript
      - typescript-operations
    config:
      # Force all fields to be nullable in types
      defaultMapper: "T | null | undefined"
      maybeValue: "T | null | undefined"
      avoidOptionals: false
      scalars:
        DateTime: Date
        Date: Date
        JSON: any
        Decimal: number

  ./src/generated/schema.graphql:
    plugins:
      - schema-ast
    config:
      includeDirectives: true
      federation: true

  ./src/generated/introspection.json:
    plugins:
      - introspection
    config:
      minify: true

  ./src/generated/gateway-utils.ts:
    plugins:
      - add:
          content: |
            import { buildClientSchema, getIntrospectionQuery, IntrospectionQuery } from 'graphql';
            import { GraphQLClient } from 'graphql-request';
            import introspectionResult from './introspection.json';
            
            export const federatedSchema = buildClientSchema(introspectionResult as IntrospectionQuery);
